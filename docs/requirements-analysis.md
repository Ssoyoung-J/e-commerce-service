# 테크스펙

## e-커머스 상품 주문 서비스

### 기능적 요구사항

- 잔액 조회 API(사용자 → UserPoint)


    | 입력 | 결과 | 설명 | 필수 조건 |
    | --- | --- | --- | --- |
    | 사용자 식별자 | 사용자의 잔액 | 사용자가 보유하고 있는 금액 조회 |  |
- 잔액 충전 API


    | 입력 | 결과 | 설명 | 필수 조건 |
    | --- | --- | --- | --- |
    | 사용자 식별자,
    충전할 금액 | 사용자의 잔액 | 사용자가 상품을 구매할 수 있는 잔액를 충전 |  |
    - 전제 조건
        - 사용자는 항상 양수만 충전 가능
        - 금액의 최대값을 초과해서 충전 불가
        - 주문과 충전을 동시에 진행이 가능해야함
- 상품 목록 조회 API


    | 입력 | 결과 | 설명 | 필수 조건 |
    | --- | --- | --- | --- |
    |  | 상품 정보 목록(ID, 이름, 잔여수량) | 사용자가 현재 구매할 수 있는 상품  목록 조회 |  |
    - 전제 조건
        - 사용자의 상품 구매/취소에 따른 상품 재고 수량이 정확해야함
- 상품 단건 조회 API


    | 입력 | 결과 | 설명 | 필수 조건 |
    | --- | --- | --- | --- |
    | 상품 ID | 상품 정보 (ID, 이름, 잔여수량) | 사용자가 현재 구매할 수 있는 상품  정보 조회 |  |
    - 전제 조건
        - 사용자의 상품 구매/취소에 따른 상품 재고 수량이 정확해야함

- 주문/결제 API (분리 필요)


    | 입력 | 결과 | 설명 | 필수 조건 |
    | --- | --- | --- | --- |
    | 상품 식별자,
    상품 ID,
    수량 | 주문 내역 | 사용자가 소유한 잔액를 상품의 금액만큼 차감한 후 상품을 주문 | 데이터 분석을 위해 결제 성공 시에 실시간으로 주문 정보를 데이터 플랫폼에 전송 |
    - 기 충전된 잔액을 기반으로 결제를 수행 → 결제 성공 시, 잔액 차감 / 결제 실패 시, 결제 실패 예외처리
    - 사용자가 구매한 상품의 재고 수량만큼 현재 상품 재고 수량에서 차감
    - 주문 시점에 선택한 상품의 재고 수량 ≤ 구매 수량일 경우 주문 불가
    - 주문 시점에 사용자가 보유한 잔액 ≤ 구매에 필요한 잔액일 경우 주문 불가
    - 데이터 플랫폼과의 상호작용이 주문에 영향을 미쳐선 안됨
    - 충전과 재고 수량의 비중?
- 선착순 쿠폰 발급 API


    | 입력 | 결과 | 설명 | 필수 조건 |
    | --- | --- | --- | --- |
    | 사용자 식별자, 
    쿠폰 식별자,
    할인 금액 | 발급된 쿠폰 | 사용자에게 할인 쿠폰을 발급 |  |
    - 선착순 쿠폰과 사용자와는 1:1 관계
    - 동시에 여러 사용자가 쿠폰을 발급하더라도 정해진 개수만큼 할인 쿠폰 발급
    - 할인 혜택은 할인 쿠폰 가격을 기준으로 제공(비율 X)
- 선착순 쿠폰 목록 조회 API


    | 입력 | 결과 | 설명 | 필수 조건 |
    | --- | --- | --- | --- |
    | 사용자 식별자 | 사용자가 보유한 사용가능한 쿠폰 목록 | 사용자가 보유한 쿠폰 목록 조회 |  |
    - 이미 사용한 쿠폰은 조회 하지 않음
    - 주문 시 유효한 할인 쿠폰을 함께 제출하면, 전체 금액에서 할인 혜택을 부여
- 인기 판매 상품 조회 API
    - 인기 판매 상품의 기준은 무엇일까?
        - 최근 3일 간 판매량의 평균치가 가장 높은 5개의 상품
    - 인기 판매 상품 조회를 통해 얻고 싶은 결과가 무엇일까?
        - 단순한 상품 순위일까?
        - 상품의 상세 정보일까?

      → 인기 판매 상품 조회를 통해 얻고 싶은 건 단순 통계일까 아니면 사용자의 소비 촉구일까?


    | 입력 | 결과 | 설명 | 필수 조건 |
    | --- | --- | --- | --- |
    | 현재 일자 | 상위 상품 목록 | 최근 3일간 판매량의 평균치가 높은 순서대로 5개의 상품 정보 제공 → 굳이 평균치를 위한 계산이 필요없을거같긴함 | 현재 일로부터 3일,
    ex) 04/01 조회 시,
    03/29 00:00:00~ 03/31 11:59:59까지의 판매량 평균치 |

### 비기능적 요구사항

- 동시에 많은 사용자가 주문하더라고 상품의 재고 수량이 누락되지 않아야 함
- 동시에 많은 사용자가 주문하더라도 사용자의 소유 금액에 대한 차감이 누락되지 않아야 함
- 특정 사용자가 동시에 충전과 상품 주문을 하더라도 소유 금액에 대한 충전/차감이 누락되지 않아야 함
- 모든 요청에 대한 응답은 5s 이내

- 팀내 토론
    - 무통장입금과 같이 만료시점이 있는 주문일 경우 고려 필요
    - 결제 대기, 주문, 주문 확정 등의 주문 상태
    - 재고관리가 뒤에 있을 경우 → 주문이 치열할 경우,, 주문생성 이후 재고 관리를 한다면..
    - 도메인을 나누는 기준? → 행위를 위해서 무엇이 필요한가? (주문을 위해서 무엇이 필요한가)
    - 인기 상품에 대해서 주문테이블에서 관리할지, 테이블을 별도로 관리할지

### 설계

- 도메인 기준 설계 작성
- 도메인을 분리하는 기준 → 행위를 위해서 무엇이 필요한가?
- 주문이라는 행위?
    - 사용자 포인트(UserPoint)
    - 주문 상품(Product)
- 외부 플랫폼 연계 필요
- activate  bar
- 클래스 설계
    - Order
    - Product
    - Coupon
    - UserPoint
- 다건 주문